# AI Coding UGC社区平台服务端开发指令

**⚠️ 严格按照指示执行，不多做任何冗余、多余的工作。未经明确批准的事项一律不得执行。**

## 核心原则
1. 严格遵守《技术栈选型》文档
2. **分步开发 + 逐级评审**：每步必须经您回复“通过”后才生成代码
3. 所有设计沉淀至《技术框架设计》文档（追加式记录）
4. 每步完成后同步更新《开发进度日志》，记录状态、交付物与验证结果，便于复盘与接续开发
5. **Git 提交规范**：所有 commit 信息必须使用中文，遵循 conventional commit 格式（如 `feat(模块): 描述`、`fix(模块): 描述`、`docs: 描述`）；每步代码完成后，必须经您回复"通过"后才可执行 commit
6. **API 接口文档**：每步新增或修改 API 接口时，同步更新《API接口文档》，记录 URL、方法、入参、返回值和 curl 调用示例
7. **验证记录**：《开发进度日志》中的验证部分必须记录完整的请求命令（含入参）和实际返回值（精确到响应体），作为可追溯的测试证据；动态值（UUID、token、时间戳）如无法保留原始值，须保留完整字段结构并用脱敏占位标注
## 每步设计方案强制结构（缺一不可）
提交设计方案时，必须包含以下5部分：
1. **【本步目标】**  
   - 明确交付物（例：“完成用户注册/登录API骨架”）
2. **【技术方案】**  
   - 关键代码结构/流程图/伪代码（非完整代码）  
   - 依赖的外部服务清单（例：Neon, R2）
3. **【需您准备】**（清单式，带复选框，示例如下）  
   - [ ] 变量名：`AUTH_SECRET` | 用途：BetterAuth签名密钥 | 获取方式：生成32位随机字符串  
   - [ ] 变量名：`DATABASE_URL` | 用途：Neon连接串 | 获取方式：Neon控制台 → Connection String  
   - [ ] ...（其他必需项）
4. **【安全验证点】**  
   - 代码中无硬编码密钥（仅`process.env.XXX`）  
   - `.gitignore`已排除`.env`/敏感文件  
   - 提供`.env.example`（仅变量名，无真实值）
5. **【测试方案】**  
   - 验证步骤（例：“Postman调用POST /auth/register，检查返回201"）  
   - 预期结果  
   - 涉及 Cookie 认证的接口，必须说明 Cookie 的完整获取方式（推荐 `curl -c tmp/cookies.txt` / `-b tmp/cookies.txt`），禁止仅引用 JSON 响应体中的 token 字段作为 Cookie 值

## 安全铁律（违反即终止）
- 🔒 **严禁参考任何含硬编码密钥的示例代码**（包括 demo 文件夹内内容）  
- 🔒 代码中敏感信息仅通过 `process.env.XXX` 访问（`XXX` 为变量名，Node.js 代码中访问环境变量的语法）  
- 🔒 每步必须提供 `.env.example` 模板，要求：  
  • 仅含变量名 + **尖括号占位符**（如 `DATABASE_URL=<YOUR_NEON_URL>`）  
  • 顶部含明确注释：“复制为 .env 后替换 < > 内容，勿提交 .env"  
  • **绝对无真实密钥片段**（包括 `your_`/`test_` 等易混淆前缀）  
- 🔒 交付代码必须包含：  
  • `.gitignore`（明确排除 `.env`, `*.key`, `secrets/`）  
  • `SECURITY.md`（说明：环境变量由部署平台配置，本地用 .env 仅开发测试）