# 微型内容社区平台技术方案

## 一、项目背景
- **业务定位**：轻量级UGC社区平台，支持图文/短视频发布、评论、点赞、关注
- **目标用户**：AI Coding垂直领域创作者与兴趣社群，发布AI Coding提示词、生成的源代码、效果录屏
- **当前阶段**：MVP验证期（6个月内DAU < 1万）

## 二、技术栈选型（全栈TypeScript · Serverless优先）
| 层级 | 技术组件 | 选择理由 |
|------|----------|----------|
| 应用框架 | NestJS | 模块化结构 + 强类型保障，避免MVP后代码混乱 |
| 鉴权系统 | BetterAuth | 1天集成注册/登录/会话，内置Passkey安全能力 |
| 数据库 | Neon (PostgreSQL) | Serverless免运维 + 分支即环境，生产级可靠性 |
| 对象存储 | Cloudflare R2 | 零流量费 + 内置CDN，成本结构随规模优化 |
| 缓存层 | Upstash Redis | 按量付费，支撑高频操作（成长期按需启用） |
| 部署平台 | Railway | GitOps自动部署，10分钟上线MVP |
| ORM | Drizzle ORM | 轻量类型安全，与BetterAuth深度集成 |

## 三、核心基础功能
- **用户体系**：BetterAuth实现注册/登录/会话，预留OAuth扩展
- **文件存储**：前端直传R2（图片≤2MB/视频≤50MB），URL存Neon，CDN自动加速
- **数据持久化**：Neon存用户、内容、互动关系；关键查询建索引
- **高频优化**：Redis缓存点赞计数、API限流（成长期按需启用）
- **内容安全**：前端关键词过滤 + 人工审核兜底（MVP务实策略）
- **部署运维**：Railway + Dockerfile，环境变量管理，Git Push自动部署

## 四、核心业务功能
- **内容发布**：文本+图片/短视频 → R2直传 → 存元数据至Neon
- **内容浏览**：时间流分页加载，返回含CDN链接列表
- **点赞互动**：BetterAuth校验 → Neon写入（唯一索引）→ Redis更新计数
- **评论系统**：`comments`表含`parent_id`，支持楼中楼回复
- **用户关注**：`follows`表管理双向关系，联合唯一索引防重复
- **举报机制**：用户提交 → 后台人工处理，低成本保障社区健康

## 五、技术弹性设计（为未来留白）
### ✅ 核心理念
> **当前技术栈经行业验证具备长期支撑能力。本方案通过三层隔离设计，确保系统在业务演进中具备技术调整弹性，同时避免过早优化。所有设计均以最小成本实现，聚焦MVP验证。**

### 🔑 三层隔离设计（Day 1贯彻）
| 设计层 | 实施要点 | 价值 |
|--------|----------|------|
| 容器化隔离 | 标准Dockerfile（仅依赖官方Node镜像） | 更换部署平台时构建流程零改动 |
| 配置隔离 | 所有环境变量通过环境变量注入 | 环境切换无需修改代码 |
| 服务抽象隔离 | 存储操作封装为`StorageService`接口 | 调整存储方案时仅替换实现类 |

### 🌱 实施建议
- MVP阶段：实现`R2Adapter`作为默认实现，业务代码仅依赖接口
- 持续监控：记录成本、延迟、错误率等关键指标
- 调整原则：仅当业务需求明确要求时，利用隔离层快速响应；当前方案持续满足需求则无需调整

> 💡 **设计哲学**：  
> **“用最小成本购买技术期权”** ——  
> 通过1天的抽象层设计，为未来可能的技术调整预留低成本路径，  
> 同时将99%的精力聚焦于验证核心业务假设：  
> **用户是否愿意在此平台创作与互动。**